/******/ (() => { // webpackBootstrap
var __webpack_exports__ = {};
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
var editedID = 0;
var editMode = false;

function getNewID() {
  return new Date().getTime().toString();
}

function addItem() {
  var title = getValue('title-input');

  if (title == '') {
    alert('cant add an item without a title');
    return;
  }

  if (editMode) {
    alert('cant add an item while in edit mode');
    return;
  }

  var content = getValue('content-input');
  var list = document.getElementById('list');
  var id = getNewID();
  setItemToLocalstorage(id, title, content);
  var itemElement = createTodoItemElement(id, title, content);
  list.appendChild(itemElement); // reset menu display

  clearMenu();
  setInnerText('apply-button', 'Add');
}

function setItemToLocalstorage(id, title, content) {
  var item = {
    "title": title,
    "content": content
  };
  var todoListString = localStorage.getItem('TODO-List');
  var todoMap = JSON.parse(todoListString); //inset item to todo map

  todoMap[id] = item;
  localStorage.setItem('TODO-List', JSON.stringify(todoMap));
}

function removeItemFromLocalstorage(id) {
  var todoListString = localStorage.getItem('TODO-List');
  var todoMap = JSON.parse(todoListString); //inset item to todo map

  delete todoMap[id];
  localStorage.setItem('TODO-List', JSON.stringify(todoMap));
}

function sendItemToEdit(itemID) {
  editedID = itemID;
  var title = getInnerText("title".concat(itemID));
  var content = getInnerText("content".concat(itemID));
  setValue('title-input', title);
  setValue('content-input', content);
  editMode = true;
  document.getElementById('cancel-button').hidden = false;
  setInnerText('apply-button', 'Apply');
}

function deleteItem(itemID) {
  if (editMode) {
    alert('cant delete while in edit mode');
    return;
  }

  var item = document.getElementById(itemID);
  var list = document.getElementById('list'); // remove from display

  list.removeChild(item); // remove from item storage

  localStorage.removeItem(itemID);
}

function cancelEdit() {
  clearMenu();
  editMode = false;
  setInnerText('apply-button', 'Add');
  document.getElementById('cancel-button').hidden = true;
  editedID = 0;
}

function clearMenu() {
  setValue('title-input', '');
  setValue('content-input', '');
}

function menuButtonClick() {
  if (!editMode) {
    // adding a new item
    addItem();
  } else {
    // editing an existing item
    if (getValue('title-input') == '') {
      alert('cant set an empty title');
      return;
    }

    var title = getValue('title-input');
    var content = getValue('content-input');
    setInnerText("title".concat(editedID), title);
    setInnerText("content".concat(editedID), content); // now update item in local storage
    // const itemObject = `title: ${title};content: ${content}`

    setItemToLocalstorage(editedID, title, content); // localStorage.setItem(editedID,itemObject)
    // revert menu back to default state

    clearMenu();
    editMode = false;
    setInnerText('apply-button', 'Add');
    document.getElementById('cancel-button').hidden = true;
    editedID = 0;
  }
}

function addButton() {
  clearMenu();
  document.getElementById('title-input').focus();
}

function getValue(id) {
  return document.getElementById(id).value;
}

function setValue(id, value) {
  document.getElementById(id).value = value;
}

function getInnerText(id) {
  return document.getElementById(id).innerText;
}

function setInnerText(id, text) {
  document.getElementById(id).innerText = text;
}

function createTodoItemElement(itemID, title, content) {
  // ol todo-item
  var itemElement = document.createElement('ol');
  itemElement.className = 'todo-item';
  itemElement.id = itemID; // input checkbox

  var itemCheckboxElement = document.createElement('input');
  itemCheckboxElement.type = 'checkbox';
  itemCheckboxElement.className = 'item-checkbox'; // div todo-item-text

  var itemTextElement = createItemTextElement(itemID, title, content);
  var itemButtonsElement = createItemButtonsElement(itemID); // append checkbox, text and buttons to list-item

  itemElement.appendChild(itemCheckboxElement);
  itemElement.appendChild(itemTextElement);
  itemElement.appendChild(itemButtonsElement);
  return itemElement;
}

function createItemButtonsElement(itemID) {
  var itemButtonsElement = document.createElement('div');
  itemButtonsElement.className = 'todo-item-buttons'; // button edit

  var editButtonElement = document.createElement('button');
  editButtonElement.innerText = 'edit';
  editButtonElement.className = 'item-edit-button';

  editButtonElement.onclick = function () {
    // set menu to editing state
    editMode = true;
    editedID = itemID;
    document.getElementById('cancel-button').hidden = false;
    setInnerText('apply-button', 'Apply');
    var title = getInnerText("title".concat(itemID));
    var content = getInnerText("content".concat(itemID));
    setValue('title-input', title);
    setValue('content-input', content);
  }; // button delete


  var deleteButtonElement = document.createElement('button');
  deleteButtonElement.innerText = 'delete';
  deleteButtonElement.className = 'item-delete-button';

  deleteButtonElement.onclick = function () {
    if (editMode) {
      alert('cant delete while in edit mode');
      return;
    }

    var item = document.getElementById(itemID);
    var list = document.getElementById('list'); // remove from display

    list.removeChild(item); // remove from item storage

    removeItemFromLocalstorage(itemID);
  }; // append the buttons to container


  itemButtonsElement.appendChild(editButtonElement);
  itemButtonsElement.appendChild(deleteButtonElement);
  return itemButtonsElement;
}

function createItemTextElement(itemID, title, content) {
  var itemTextElement = document.createElement('div');
  itemTextElement.className = 'todo-item-text'; // item title

  var titleElement = document.createElement('div');
  titleElement.innerText = title;
  titleElement.className = 'todo-item-title';
  titleElement.id = 'title' + itemID; // item content

  var contentElement = document.createElement('div');
  contentElement.innerText = content;
  contentElement.className = 'todo-item-content';
  contentElement.id = 'content' + itemID; // append text to parent container 

  itemTextElement.appendChild(titleElement);
  itemTextElement.appendChild(contentElement);
  return itemTextElement;
}

window.onload = function () {
  // attach functions to menu buttons
  document.getElementById('menu').addEventListener('keyup', function (event) {
    if (event.keyCode === 13) {
      document.getElementById('apply-button').click();
      document.getElementById('title-input').focus();
    }
  });
  document.getElementById('clear-button').onclick = clearMenu;
  document.getElementById('apply-button').onclick = menuButtonClick;
  document.getElementById('cancel-button').onclick = cancelEdit;
  document.getElementById('add-button').onclick = addButton; // init todo list in storage

  if (localStorage.getItem('TODO-List') == null) {
    var _todoMap = JSON.stringify({});

    localStorage.setItem('TODO-List', _todoMap);
  } // load and display todo items from local storage


  var todoListString = localStorage.getItem('TODO-List');
  var todoMap = JSON.parse(todoListString);
  var list = document.getElementById('list');

  for (var key in todoMap) {
    var item = todoMap[key];
    var title = item['title'];
    var content = item['content'];
    var itemElement = createTodoItemElement(key, title, content);
    list.appendChild(itemElement);
  }
};
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi4zNTU0Yjg3YTM1ODgxYTYyMTM0Zi5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLElBQUlBLFFBQVEsR0FBRyxDQUFmO0FBQ0EsSUFBSUMsUUFBUSxHQUFHLEtBQWY7O0FBRUEsU0FBU0MsUUFBVCxHQUFtQjtBQUNmLFNBQU8sSUFBSUMsSUFBSixHQUFXQyxPQUFYLEdBQXFCQyxRQUFyQixFQUFQO0FBQ0g7O0FBQ0QsU0FBU0MsT0FBVCxHQUFrQjtBQUNkLE1BQU1DLEtBQUssR0FBR0MsUUFBUSxDQUFDLGFBQUQsQ0FBdEI7O0FBQ0EsTUFBSUQsS0FBSyxJQUFJLEVBQWIsRUFBZ0I7QUFDWkUsSUFBQUEsS0FBSyxDQUFDLGtDQUFELENBQUw7QUFDQTtBQUNIOztBQUNELE1BQUlSLFFBQUosRUFBYTtBQUNUUSxJQUFBQSxLQUFLLENBQUMscUNBQUQsQ0FBTDtBQUNBO0FBQ0g7O0FBQ0QsTUFBTUMsT0FBTyxHQUFHRixRQUFRLENBQUMsZUFBRCxDQUF4QjtBQUNBLE1BQU1HLElBQUksR0FBR0MsUUFBUSxDQUFDQyxjQUFULENBQXdCLE1BQXhCLENBQWI7QUFDQSxNQUFNQyxFQUFFLEdBQUdaLFFBQVEsRUFBbkI7QUFDQWEsRUFBQUEscUJBQXFCLENBQUNELEVBQUQsRUFBS1AsS0FBTCxFQUFXRyxPQUFYLENBQXJCO0FBQ0EsTUFBTU0sV0FBVyxHQUFHQyxxQkFBcUIsQ0FBQ0gsRUFBRCxFQUFJUCxLQUFKLEVBQVVHLE9BQVYsQ0FBekM7QUFDQUMsRUFBQUEsSUFBSSxDQUFDTyxXQUFMLENBQWlCRixXQUFqQixFQWZjLENBZ0JkOztBQUNBRyxFQUFBQSxTQUFTO0FBQ1RDLEVBQUFBLFlBQVksQ0FBQyxjQUFELEVBQWdCLEtBQWhCLENBQVo7QUFDSDs7QUFDRCxTQUFTTCxxQkFBVCxDQUErQkQsRUFBL0IsRUFBbUNQLEtBQW5DLEVBQTBDRyxPQUExQyxFQUFrRDtBQUM5QyxNQUFNVyxJQUFJLEdBQUc7QUFDVCxhQUFTZCxLQURBO0FBRVQsZUFBV0c7QUFGRixHQUFiO0FBSUEsTUFBTVksY0FBYyxHQUFHQyxZQUFZLENBQUNDLE9BQWIsQ0FBcUIsV0FBckIsQ0FBdkI7QUFDQSxNQUFNQyxPQUFPLEdBQUdDLElBQUksQ0FBQ0MsS0FBTCxDQUFXTCxjQUFYLENBQWhCLENBTjhDLENBTzlDOztBQUNBRyxFQUFBQSxPQUFPLENBQUNYLEVBQUQsQ0FBUCxHQUFZTyxJQUFaO0FBQ0FFLEVBQUFBLFlBQVksQ0FBQ0ssT0FBYixDQUFxQixXQUFyQixFQUFpQ0YsSUFBSSxDQUFDRyxTQUFMLENBQWVKLE9BQWYsQ0FBakM7QUFDSDs7QUFDRCxTQUFTSywwQkFBVCxDQUFvQ2hCLEVBQXBDLEVBQXVDO0FBQ25DLE1BQU1RLGNBQWMsR0FBR0MsWUFBWSxDQUFDQyxPQUFiLENBQXFCLFdBQXJCLENBQXZCO0FBQ0EsTUFBTUMsT0FBTyxHQUFHQyxJQUFJLENBQUNDLEtBQUwsQ0FBV0wsY0FBWCxDQUFoQixDQUZtQyxDQUduQzs7QUFDQSxTQUFPRyxPQUFPLENBQUNYLEVBQUQsQ0FBZDtBQUNBUyxFQUFBQSxZQUFZLENBQUNLLE9BQWIsQ0FBcUIsV0FBckIsRUFBaUNGLElBQUksQ0FBQ0csU0FBTCxDQUFlSixPQUFmLENBQWpDO0FBQ0g7O0FBQ0QsU0FBU00sY0FBVCxDQUF3QkMsTUFBeEIsRUFBK0I7QUFFM0JoQyxFQUFBQSxRQUFRLEdBQUdnQyxNQUFYO0FBQ0EsTUFBTXpCLEtBQUssR0FBRzBCLFlBQVksZ0JBQVNELE1BQVQsRUFBMUI7QUFDQSxNQUFNdEIsT0FBTyxHQUFHdUIsWUFBWSxrQkFBV0QsTUFBWCxFQUE1QjtBQUNBRSxFQUFBQSxRQUFRLENBQUMsYUFBRCxFQUFlM0IsS0FBZixDQUFSO0FBQ0EyQixFQUFBQSxRQUFRLENBQUMsZUFBRCxFQUFpQnhCLE9BQWpCLENBQVI7QUFFQVQsRUFBQUEsUUFBUSxHQUFHLElBQVg7QUFDQVcsRUFBQUEsUUFBUSxDQUFDQyxjQUFULENBQXdCLGVBQXhCLEVBQXlDc0IsTUFBekMsR0FBa0QsS0FBbEQ7QUFDQWYsRUFBQUEsWUFBWSxDQUFDLGNBQUQsRUFBZ0IsT0FBaEIsQ0FBWjtBQUNIOztBQUVELFNBQVNnQixVQUFULENBQW9CSixNQUFwQixFQUEyQjtBQUN2QixNQUFHL0IsUUFBSCxFQUFZO0FBQ1JRLElBQUFBLEtBQUssQ0FBQyxnQ0FBRCxDQUFMO0FBQ0E7QUFDSDs7QUFDRCxNQUFNWSxJQUFJLEdBQUdULFFBQVEsQ0FBQ0MsY0FBVCxDQUF3Qm1CLE1BQXhCLENBQWI7QUFDQSxNQUFNckIsSUFBSSxHQUFHQyxRQUFRLENBQUNDLGNBQVQsQ0FBd0IsTUFBeEIsQ0FBYixDQU51QixDQU92Qjs7QUFDQUYsRUFBQUEsSUFBSSxDQUFDMEIsV0FBTCxDQUFpQmhCLElBQWpCLEVBUnVCLENBU3ZCOztBQUNBRSxFQUFBQSxZQUFZLENBQUNlLFVBQWIsQ0FBd0JOLE1BQXhCO0FBQ0g7O0FBRUQsU0FBU08sVUFBVCxHQUFxQjtBQUNqQnBCLEVBQUFBLFNBQVM7QUFDVGxCLEVBQUFBLFFBQVEsR0FBRyxLQUFYO0FBQ0FtQixFQUFBQSxZQUFZLENBQUMsY0FBRCxFQUFnQixLQUFoQixDQUFaO0FBQ0FSLEVBQUFBLFFBQVEsQ0FBQ0MsY0FBVCxDQUF3QixlQUF4QixFQUF5Q3NCLE1BQXpDLEdBQWtELElBQWxEO0FBQ0FuQyxFQUFBQSxRQUFRLEdBQUcsQ0FBWDtBQUNIOztBQUVELFNBQVNtQixTQUFULEdBQW9CO0FBQ2hCZSxFQUFBQSxRQUFRLENBQUMsYUFBRCxFQUFlLEVBQWYsQ0FBUjtBQUNBQSxFQUFBQSxRQUFRLENBQUMsZUFBRCxFQUFpQixFQUFqQixDQUFSO0FBQ0g7O0FBRUQsU0FBU00sZUFBVCxHQUEwQjtBQUN0QixNQUFHLENBQUN2QyxRQUFKLEVBQWE7QUFDVDtBQUNBSyxJQUFBQSxPQUFPO0FBQ1YsR0FIRCxNQUdLO0FBQ0Q7QUFDQSxRQUFJRSxRQUFRLENBQUMsYUFBRCxDQUFSLElBQXlCLEVBQTdCLEVBQWdDO0FBQzVCQyxNQUFBQSxLQUFLLENBQUMseUJBQUQsQ0FBTDtBQUNBO0FBQ0g7O0FBQ0QsUUFBTUYsS0FBSyxHQUFHQyxRQUFRLENBQUMsYUFBRCxDQUF0QjtBQUNBLFFBQU1FLE9BQU8sR0FBR0YsUUFBUSxDQUFDLGVBQUQsQ0FBeEI7QUFDQVksSUFBQUEsWUFBWSxnQkFBU3BCLFFBQVQsR0FBb0JPLEtBQXBCLENBQVo7QUFDQWEsSUFBQUEsWUFBWSxrQkFBV3BCLFFBQVgsR0FBc0JVLE9BQXRCLENBQVosQ0FUQyxDQVVEO0FBQ0E7O0FBQ0FLLElBQUFBLHFCQUFxQixDQUFDZixRQUFELEVBQVdPLEtBQVgsRUFBa0JHLE9BQWxCLENBQXJCLENBWkMsQ0FhRDtBQUNBOztBQUNBUyxJQUFBQSxTQUFTO0FBQ1RsQixJQUFBQSxRQUFRLEdBQUcsS0FBWDtBQUNBbUIsSUFBQUEsWUFBWSxDQUFDLGNBQUQsRUFBZ0IsS0FBaEIsQ0FBWjtBQUNBUixJQUFBQSxRQUFRLENBQUNDLGNBQVQsQ0FBd0IsZUFBeEIsRUFBeUNzQixNQUF6QyxHQUFrRCxJQUFsRDtBQUNBbkMsSUFBQUEsUUFBUSxHQUFHLENBQVg7QUFDSDtBQUNKOztBQUNELFNBQVN5QyxTQUFULEdBQW9CO0FBQ2hCdEIsRUFBQUEsU0FBUztBQUNUUCxFQUFBQSxRQUFRLENBQUNDLGNBQVQsQ0FBd0IsYUFBeEIsRUFBdUM2QixLQUF2QztBQUNIOztBQUNELFNBQVNsQyxRQUFULENBQWtCTSxFQUFsQixFQUFxQjtBQUNqQixTQUFPRixRQUFRLENBQUNDLGNBQVQsQ0FBd0JDLEVBQXhCLEVBQTRCNkIsS0FBbkM7QUFDSDs7QUFDRCxTQUFTVCxRQUFULENBQWtCcEIsRUFBbEIsRUFBcUI2QixLQUFyQixFQUEyQjtBQUN2Qi9CLEVBQUFBLFFBQVEsQ0FBQ0MsY0FBVCxDQUF3QkMsRUFBeEIsRUFBNEI2QixLQUE1QixHQUFvQ0EsS0FBcEM7QUFDSDs7QUFDRCxTQUFTVixZQUFULENBQXNCbkIsRUFBdEIsRUFBeUI7QUFDckIsU0FBT0YsUUFBUSxDQUFDQyxjQUFULENBQXdCQyxFQUF4QixFQUE0QjhCLFNBQW5DO0FBQ0g7O0FBQ0QsU0FBU3hCLFlBQVQsQ0FBc0JOLEVBQXRCLEVBQXlCK0IsSUFBekIsRUFBOEI7QUFDMUJqQyxFQUFBQSxRQUFRLENBQUNDLGNBQVQsQ0FBd0JDLEVBQXhCLEVBQTRCOEIsU0FBNUIsR0FBd0NDLElBQXhDO0FBQ0g7O0FBQ0QsU0FBUzVCLHFCQUFULENBQStCZSxNQUEvQixFQUFzQ3pCLEtBQXRDLEVBQTRDRyxPQUE1QyxFQUFvRDtBQUNoRDtBQUNBLE1BQU1NLFdBQVcsR0FBR0osUUFBUSxDQUFDa0MsYUFBVCxDQUF1QixJQUF2QixDQUFwQjtBQUNBOUIsRUFBQUEsV0FBVyxDQUFDK0IsU0FBWixHQUF3QixXQUF4QjtBQUNBL0IsRUFBQUEsV0FBVyxDQUFDRixFQUFaLEdBQWlCa0IsTUFBakIsQ0FKZ0QsQ0FLaEQ7O0FBQ0EsTUFBTWdCLG1CQUFtQixHQUFHcEMsUUFBUSxDQUFDa0MsYUFBVCxDQUF1QixPQUF2QixDQUE1QjtBQUNBRSxFQUFBQSxtQkFBbUIsQ0FBQ0MsSUFBcEIsR0FBMkIsVUFBM0I7QUFDQUQsRUFBQUEsbUJBQW1CLENBQUNELFNBQXBCLEdBQWdDLGVBQWhDLENBUmdELENBU2hEOztBQUNBLE1BQU1HLGVBQWUsR0FBR0MscUJBQXFCLENBQUNuQixNQUFELEVBQVF6QixLQUFSLEVBQWNHLE9BQWQsQ0FBN0M7QUFDQSxNQUFNMEMsa0JBQWtCLEdBQUdDLHdCQUF3QixDQUFDckIsTUFBRCxDQUFuRCxDQVhnRCxDQVloRDs7QUFDQWhCLEVBQUFBLFdBQVcsQ0FBQ0UsV0FBWixDQUF3QjhCLG1CQUF4QjtBQUNBaEMsRUFBQUEsV0FBVyxDQUFDRSxXQUFaLENBQXdCZ0MsZUFBeEI7QUFDQWxDLEVBQUFBLFdBQVcsQ0FBQ0UsV0FBWixDQUF3QmtDLGtCQUF4QjtBQUVBLFNBQU9wQyxXQUFQO0FBQ0g7O0FBQ0QsU0FBU3FDLHdCQUFULENBQWtDckIsTUFBbEMsRUFBeUM7QUFFckMsTUFBTW9CLGtCQUFrQixHQUFHeEMsUUFBUSxDQUFDa0MsYUFBVCxDQUF1QixLQUF2QixDQUEzQjtBQUNBTSxFQUFBQSxrQkFBa0IsQ0FBQ0wsU0FBbkIsR0FBK0IsbUJBQS9CLENBSHFDLENBSXJDOztBQUNBLE1BQU1PLGlCQUFpQixHQUFHMUMsUUFBUSxDQUFDa0MsYUFBVCxDQUF1QixRQUF2QixDQUExQjtBQUNBUSxFQUFBQSxpQkFBaUIsQ0FBQ1YsU0FBbEIsR0FBOEIsTUFBOUI7QUFDQVUsRUFBQUEsaUJBQWlCLENBQUNQLFNBQWxCLEdBQThCLGtCQUE5Qjs7QUFDQU8sRUFBQUEsaUJBQWlCLENBQUNDLE9BQWxCLEdBQTRCLFlBQVU7QUFDbEM7QUFDQXRELElBQUFBLFFBQVEsR0FBRyxJQUFYO0FBQ0FELElBQUFBLFFBQVEsR0FBR2dDLE1BQVg7QUFDQXBCLElBQUFBLFFBQVEsQ0FBQ0MsY0FBVCxDQUF3QixlQUF4QixFQUF5Q3NCLE1BQXpDLEdBQWtELEtBQWxEO0FBQ0FmLElBQUFBLFlBQVksQ0FBQyxjQUFELEVBQWdCLE9BQWhCLENBQVo7QUFDQSxRQUFNYixLQUFLLEdBQUcwQixZQUFZLGdCQUFTRCxNQUFULEVBQTFCO0FBQ0EsUUFBTXRCLE9BQU8sR0FBR3VCLFlBQVksa0JBQVdELE1BQVgsRUFBNUI7QUFDQUUsSUFBQUEsUUFBUSxDQUFDLGFBQUQsRUFBZTNCLEtBQWYsQ0FBUjtBQUNBMkIsSUFBQUEsUUFBUSxDQUFDLGVBQUQsRUFBaUJ4QixPQUFqQixDQUFSO0FBQ0gsR0FWRCxDQVJxQyxDQW1CckM7OztBQUNBLE1BQU04QyxtQkFBbUIsR0FBRzVDLFFBQVEsQ0FBQ2tDLGFBQVQsQ0FBdUIsUUFBdkIsQ0FBNUI7QUFDQVUsRUFBQUEsbUJBQW1CLENBQUNaLFNBQXBCLEdBQWdDLFFBQWhDO0FBQ0FZLEVBQUFBLG1CQUFtQixDQUFDVCxTQUFwQixHQUFnQyxvQkFBaEM7O0FBQ0FTLEVBQUFBLG1CQUFtQixDQUFDRCxPQUFwQixHQUE4QixZQUFVO0FBQ3BDLFFBQUd0RCxRQUFILEVBQVk7QUFDUlEsTUFBQUEsS0FBSyxDQUFDLGdDQUFELENBQUw7QUFDQTtBQUNIOztBQUNELFFBQU1ZLElBQUksR0FBR1QsUUFBUSxDQUFDQyxjQUFULENBQXdCbUIsTUFBeEIsQ0FBYjtBQUNBLFFBQU1yQixJQUFJLEdBQUdDLFFBQVEsQ0FBQ0MsY0FBVCxDQUF3QixNQUF4QixDQUFiLENBTm9DLENBT3BDOztBQUNBRixJQUFBQSxJQUFJLENBQUMwQixXQUFMLENBQWlCaEIsSUFBakIsRUFSb0MsQ0FTcEM7O0FBQ0FTLElBQUFBLDBCQUEwQixDQUFDRSxNQUFELENBQTFCO0FBQ0gsR0FYRCxDQXZCcUMsQ0FtQ3JDOzs7QUFDQW9CLEVBQUFBLGtCQUFrQixDQUFDbEMsV0FBbkIsQ0FBK0JvQyxpQkFBL0I7QUFDQUYsRUFBQUEsa0JBQWtCLENBQUNsQyxXQUFuQixDQUErQnNDLG1CQUEvQjtBQUVBLFNBQU9KLGtCQUFQO0FBQ0g7O0FBQ0QsU0FBU0QscUJBQVQsQ0FBK0JuQixNQUEvQixFQUFzQ3pCLEtBQXRDLEVBQTRDRyxPQUE1QyxFQUFvRDtBQUVoRCxNQUFNd0MsZUFBZSxHQUFHdEMsUUFBUSxDQUFDa0MsYUFBVCxDQUF1QixLQUF2QixDQUF4QjtBQUNBSSxFQUFBQSxlQUFlLENBQUNILFNBQWhCLEdBQTRCLGdCQUE1QixDQUhnRCxDQUloRDs7QUFDQSxNQUFNVSxZQUFZLEdBQUc3QyxRQUFRLENBQUNrQyxhQUFULENBQXVCLEtBQXZCLENBQXJCO0FBQ0FXLEVBQUFBLFlBQVksQ0FBQ2IsU0FBYixHQUF5QnJDLEtBQXpCO0FBQ0FrRCxFQUFBQSxZQUFZLENBQUNWLFNBQWIsR0FBeUIsaUJBQXpCO0FBQ0FVLEVBQUFBLFlBQVksQ0FBQzNDLEVBQWIsR0FBa0IsVUFBUWtCLE1BQTFCLENBUmdELENBU2hEOztBQUNBLE1BQU0wQixjQUFjLEdBQUc5QyxRQUFRLENBQUNrQyxhQUFULENBQXVCLEtBQXZCLENBQXZCO0FBQ0FZLEVBQUFBLGNBQWMsQ0FBQ2QsU0FBZixHQUEyQmxDLE9BQTNCO0FBQ0FnRCxFQUFBQSxjQUFjLENBQUNYLFNBQWYsR0FBMkIsbUJBQTNCO0FBQ0FXLEVBQUFBLGNBQWMsQ0FBQzVDLEVBQWYsR0FBb0IsWUFBVWtCLE1BQTlCLENBYmdELENBY2hEOztBQUNBa0IsRUFBQUEsZUFBZSxDQUFDaEMsV0FBaEIsQ0FBNEJ1QyxZQUE1QjtBQUNBUCxFQUFBQSxlQUFlLENBQUNoQyxXQUFoQixDQUE0QndDLGNBQTVCO0FBRUEsU0FBT1IsZUFBUDtBQUNIOztBQUVEUyxNQUFNLENBQUNDLE1BQVAsR0FBZ0IsWUFBVTtBQUN0QjtBQUNBaEQsRUFBQUEsUUFBUSxDQUFDQyxjQUFULENBQXdCLE1BQXhCLEVBQWdDZ0QsZ0JBQWhDLENBQWlELE9BQWpELEVBQTBELFVBQVNDLEtBQVQsRUFBZ0I7QUFDdEUsUUFBSUEsS0FBSyxDQUFDQyxPQUFOLEtBQWtCLEVBQXRCLEVBQTBCO0FBQ3RCbkQsTUFBQUEsUUFBUSxDQUFDQyxjQUFULENBQXdCLGNBQXhCLEVBQXdDbUQsS0FBeEM7QUFDQXBELE1BQUFBLFFBQVEsQ0FBQ0MsY0FBVCxDQUF3QixhQUF4QixFQUF1QzZCLEtBQXZDO0FBQ0g7QUFDSixHQUxEO0FBTUE5QixFQUFBQSxRQUFRLENBQUNDLGNBQVQsQ0FBd0IsY0FBeEIsRUFBd0MwQyxPQUF4QyxHQUFrRHBDLFNBQWxEO0FBQ0FQLEVBQUFBLFFBQVEsQ0FBQ0MsY0FBVCxDQUF3QixjQUF4QixFQUF3QzBDLE9BQXhDLEdBQWtEZixlQUFsRDtBQUNBNUIsRUFBQUEsUUFBUSxDQUFDQyxjQUFULENBQXdCLGVBQXhCLEVBQXlDMEMsT0FBekMsR0FBbURoQixVQUFuRDtBQUNBM0IsRUFBQUEsUUFBUSxDQUFDQyxjQUFULENBQXdCLFlBQXhCLEVBQXNDMEMsT0FBdEMsR0FBZ0RkLFNBQWhELENBWHNCLENBWXRCOztBQUNBLE1BQUdsQixZQUFZLENBQUNDLE9BQWIsQ0FBcUIsV0FBckIsS0FBbUMsSUFBdEMsRUFBMkM7QUFDdkMsUUFBTUMsUUFBTyxHQUFHQyxJQUFJLENBQUNHLFNBQUwsQ0FBZSxFQUFmLENBQWhCOztBQUNBTixJQUFBQSxZQUFZLENBQUNLLE9BQWIsQ0FBcUIsV0FBckIsRUFBaUNILFFBQWpDO0FBQ0gsR0FoQnFCLENBaUJ0Qjs7O0FBQ0EsTUFBTUgsY0FBYyxHQUFHQyxZQUFZLENBQUNDLE9BQWIsQ0FBcUIsV0FBckIsQ0FBdkI7QUFDQSxNQUFNQyxPQUFPLEdBQUdDLElBQUksQ0FBQ0MsS0FBTCxDQUFXTCxjQUFYLENBQWhCO0FBQ0EsTUFBTVgsSUFBSSxHQUFHQyxRQUFRLENBQUNDLGNBQVQsQ0FBd0IsTUFBeEIsQ0FBYjs7QUFDQSxPQUFLLElBQU1vRCxHQUFYLElBQWtCeEMsT0FBbEIsRUFBMkI7QUFDdkIsUUFBTUosSUFBSSxHQUFHSSxPQUFPLENBQUN3QyxHQUFELENBQXBCO0FBQ0EsUUFBTTFELEtBQUssR0FBR2MsSUFBSSxDQUFDLE9BQUQsQ0FBbEI7QUFDQSxRQUFNWCxPQUFPLEdBQUdXLElBQUksQ0FBQyxTQUFELENBQXBCO0FBQ0EsUUFBTUwsV0FBVyxHQUFHQyxxQkFBcUIsQ0FBQ2dELEdBQUQsRUFBSzFELEtBQUwsRUFBV0csT0FBWCxDQUF6QztBQUNBQyxJQUFBQSxJQUFJLENBQUNPLFdBQUwsQ0FBaUJGLFdBQWpCO0FBQ0g7QUFDSixDQTVCRCxDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vMi13ZWJwYWNrLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImxldCBlZGl0ZWRJRCA9IDA7XG5sZXQgZWRpdE1vZGUgPSBmYWxzZTtcblxuZnVuY3Rpb24gZ2V0TmV3SUQoKXtcbiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCkudG9TdHJpbmcoKVxufVxuZnVuY3Rpb24gYWRkSXRlbSgpe1xuICAgIGNvbnN0IHRpdGxlID0gZ2V0VmFsdWUoJ3RpdGxlLWlucHV0JylcbiAgICBpZiAodGl0bGUgPT0gJycpe1xuICAgICAgICBhbGVydCgnY2FudCBhZGQgYW4gaXRlbSB3aXRob3V0IGEgdGl0bGUnKVxuICAgICAgICByZXR1cm5cbiAgICB9XG4gICAgaWYgKGVkaXRNb2RlKXtcbiAgICAgICAgYWxlcnQoJ2NhbnQgYWRkIGFuIGl0ZW0gd2hpbGUgaW4gZWRpdCBtb2RlJylcbiAgICAgICAgcmV0dXJuXG4gICAgfVxuICAgIGNvbnN0IGNvbnRlbnQgPSBnZXRWYWx1ZSgnY29udGVudC1pbnB1dCcpXG4gICAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXN0JylcbiAgICBjb25zdCBpZCA9IGdldE5ld0lEKClcbiAgICBzZXRJdGVtVG9Mb2NhbHN0b3JhZ2UoaWQsIHRpdGxlLGNvbnRlbnQpXG4gICAgY29uc3QgaXRlbUVsZW1lbnQgPSBjcmVhdGVUb2RvSXRlbUVsZW1lbnQoaWQsdGl0bGUsY29udGVudClcbiAgICBsaXN0LmFwcGVuZENoaWxkKGl0ZW1FbGVtZW50KVxuICAgIC8vIHJlc2V0IG1lbnUgZGlzcGxheVxuICAgIGNsZWFyTWVudSgpXG4gICAgc2V0SW5uZXJUZXh0KCdhcHBseS1idXR0b24nLCdBZGQnKVxufVxuZnVuY3Rpb24gc2V0SXRlbVRvTG9jYWxzdG9yYWdlKGlkLCB0aXRsZSwgY29udGVudCl7XG4gICAgY29uc3QgaXRlbSA9IHtcbiAgICAgICAgXCJ0aXRsZVwiOiB0aXRsZSxcbiAgICAgICAgXCJjb250ZW50XCI6IGNvbnRlbnRcbiAgICB9XG4gICAgY29uc3QgdG9kb0xpc3RTdHJpbmcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnVE9ETy1MaXN0JylcbiAgICBjb25zdCB0b2RvTWFwID0gSlNPTi5wYXJzZSh0b2RvTGlzdFN0cmluZylcbiAgICAvL2luc2V0IGl0ZW0gdG8gdG9kbyBtYXBcbiAgICB0b2RvTWFwW2lkXT1pdGVtXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ1RPRE8tTGlzdCcsSlNPTi5zdHJpbmdpZnkodG9kb01hcCkpXG59XG5mdW5jdGlvbiByZW1vdmVJdGVtRnJvbUxvY2Fsc3RvcmFnZShpZCl7XG4gICAgY29uc3QgdG9kb0xpc3RTdHJpbmcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnVE9ETy1MaXN0JylcbiAgICBjb25zdCB0b2RvTWFwID0gSlNPTi5wYXJzZSh0b2RvTGlzdFN0cmluZylcbiAgICAvL2luc2V0IGl0ZW0gdG8gdG9kbyBtYXBcbiAgICBkZWxldGUgdG9kb01hcFtpZF1cbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnVE9ETy1MaXN0JyxKU09OLnN0cmluZ2lmeSh0b2RvTWFwKSlcbn1cbmZ1bmN0aW9uIHNlbmRJdGVtVG9FZGl0KGl0ZW1JRCl7XG4gICAgXG4gICAgZWRpdGVkSUQgPSBpdGVtSURcbiAgICBjb25zdCB0aXRsZSA9IGdldElubmVyVGV4dChgdGl0bGUke2l0ZW1JRH1gKVxuICAgIGNvbnN0IGNvbnRlbnQgPSBnZXRJbm5lclRleHQoYGNvbnRlbnQke2l0ZW1JRH1gKVxuICAgIHNldFZhbHVlKCd0aXRsZS1pbnB1dCcsdGl0bGUpXG4gICAgc2V0VmFsdWUoJ2NvbnRlbnQtaW5wdXQnLGNvbnRlbnQpXG4gICAgXG4gICAgZWRpdE1vZGUgPSB0cnVlXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1idXR0b24nKS5oaWRkZW4gPSBmYWxzZVxuICAgIHNldElubmVyVGV4dCgnYXBwbHktYnV0dG9uJywnQXBwbHknKVxufVxuXG5mdW5jdGlvbiBkZWxldGVJdGVtKGl0ZW1JRCl7XG4gICAgaWYoZWRpdE1vZGUpe1xuICAgICAgICBhbGVydCgnY2FudCBkZWxldGUgd2hpbGUgaW4gZWRpdCBtb2RlJylcbiAgICAgICAgcmV0dXJuXG4gICAgfVxuICAgIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtSUQpXG4gICAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXN0JylcbiAgICAvLyByZW1vdmUgZnJvbSBkaXNwbGF5XG4gICAgbGlzdC5yZW1vdmVDaGlsZChpdGVtKVxuICAgIC8vIHJlbW92ZSBmcm9tIGl0ZW0gc3RvcmFnZVxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGl0ZW1JRClcbn1cblxuZnVuY3Rpb24gY2FuY2VsRWRpdCgpe1xuICAgIGNsZWFyTWVudSgpXG4gICAgZWRpdE1vZGUgPSBmYWxzZVxuICAgIHNldElubmVyVGV4dCgnYXBwbHktYnV0dG9uJywnQWRkJylcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLWJ1dHRvbicpLmhpZGRlbiA9IHRydWVcbiAgICBlZGl0ZWRJRCA9IDAgIFxufVxuXG5mdW5jdGlvbiBjbGVhck1lbnUoKXtcbiAgICBzZXRWYWx1ZSgndGl0bGUtaW5wdXQnLCcnKVxuICAgIHNldFZhbHVlKCdjb250ZW50LWlucHV0JywnJylcbn1cblxuZnVuY3Rpb24gbWVudUJ1dHRvbkNsaWNrKCl7XG4gICAgaWYoIWVkaXRNb2RlKXtcbiAgICAgICAgLy8gYWRkaW5nIGEgbmV3IGl0ZW1cbiAgICAgICAgYWRkSXRlbSgpXG4gICAgfWVsc2V7XG4gICAgICAgIC8vIGVkaXRpbmcgYW4gZXhpc3RpbmcgaXRlbVxuICAgICAgICBpZiAoZ2V0VmFsdWUoJ3RpdGxlLWlucHV0Jyk9PScnKXtcbiAgICAgICAgICAgIGFsZXJ0KCdjYW50IHNldCBhbiBlbXB0eSB0aXRsZScpXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0aXRsZSA9IGdldFZhbHVlKCd0aXRsZS1pbnB1dCcpXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBnZXRWYWx1ZSgnY29udGVudC1pbnB1dCcpXG4gICAgICAgIHNldElubmVyVGV4dChgdGl0bGUke2VkaXRlZElEfWAsdGl0bGUpXG4gICAgICAgIHNldElubmVyVGV4dChgY29udGVudCR7ZWRpdGVkSUR9YCxjb250ZW50KVxuICAgICAgICAvLyBub3cgdXBkYXRlIGl0ZW0gaW4gbG9jYWwgc3RvcmFnZVxuICAgICAgICAvLyBjb25zdCBpdGVtT2JqZWN0ID0gYHRpdGxlOiAke3RpdGxlfTtjb250ZW50OiAke2NvbnRlbnR9YFxuICAgICAgICBzZXRJdGVtVG9Mb2NhbHN0b3JhZ2UoZWRpdGVkSUQsIHRpdGxlLCBjb250ZW50KVxuICAgICAgICAvLyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShlZGl0ZWRJRCxpdGVtT2JqZWN0KVxuICAgICAgICAvLyByZXZlcnQgbWVudSBiYWNrIHRvIGRlZmF1bHQgc3RhdGVcbiAgICAgICAgY2xlYXJNZW51KClcbiAgICAgICAgZWRpdE1vZGUgPSBmYWxzZVxuICAgICAgICBzZXRJbm5lclRleHQoJ2FwcGx5LWJ1dHRvbicsJ0FkZCcpXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtYnV0dG9uJykuaGlkZGVuID0gdHJ1ZVxuICAgICAgICBlZGl0ZWRJRCA9IDBcbiAgICB9XG59XG5mdW5jdGlvbiBhZGRCdXR0b24oKXtcbiAgICBjbGVhck1lbnUoKVxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aXRsZS1pbnB1dCcpLmZvY3VzKClcbn1cbmZ1bmN0aW9uIGdldFZhbHVlKGlkKXtcbiAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLnZhbHVlXG59XG5mdW5jdGlvbiBzZXRWYWx1ZShpZCx2YWx1ZSl7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLnZhbHVlID0gdmFsdWVcbn1cbmZ1bmN0aW9uIGdldElubmVyVGV4dChpZCl7XG4gICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS5pbm5lclRleHRcbn1cbmZ1bmN0aW9uIHNldElubmVyVGV4dChpZCx0ZXh0KXtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkuaW5uZXJUZXh0ID0gdGV4dFxufVxuZnVuY3Rpb24gY3JlYXRlVG9kb0l0ZW1FbGVtZW50KGl0ZW1JRCx0aXRsZSxjb250ZW50KXtcbiAgICAvLyBvbCB0b2RvLWl0ZW1cbiAgICBjb25zdCBpdGVtRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29sJylcbiAgICBpdGVtRWxlbWVudC5jbGFzc05hbWUgPSAndG9kby1pdGVtJ1xuICAgIGl0ZW1FbGVtZW50LmlkID0gaXRlbUlEO1xuICAgIC8vIGlucHV0IGNoZWNrYm94XG4gICAgY29uc3QgaXRlbUNoZWNrYm94RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JylcbiAgICBpdGVtQ2hlY2tib3hFbGVtZW50LnR5cGUgPSAnY2hlY2tib3gnXG4gICAgaXRlbUNoZWNrYm94RWxlbWVudC5jbGFzc05hbWUgPSAnaXRlbS1jaGVja2JveCdcbiAgICAvLyBkaXYgdG9kby1pdGVtLXRleHRcbiAgICBjb25zdCBpdGVtVGV4dEVsZW1lbnQgPSBjcmVhdGVJdGVtVGV4dEVsZW1lbnQoaXRlbUlELHRpdGxlLGNvbnRlbnQpXG4gICAgY29uc3QgaXRlbUJ1dHRvbnNFbGVtZW50ID0gY3JlYXRlSXRlbUJ1dHRvbnNFbGVtZW50KGl0ZW1JRClcbiAgICAvLyBhcHBlbmQgY2hlY2tib3gsIHRleHQgYW5kIGJ1dHRvbnMgdG8gbGlzdC1pdGVtXG4gICAgaXRlbUVsZW1lbnQuYXBwZW5kQ2hpbGQoaXRlbUNoZWNrYm94RWxlbWVudClcbiAgICBpdGVtRWxlbWVudC5hcHBlbmRDaGlsZChpdGVtVGV4dEVsZW1lbnQpXG4gICAgaXRlbUVsZW1lbnQuYXBwZW5kQ2hpbGQoaXRlbUJ1dHRvbnNFbGVtZW50KVxuXG4gICAgcmV0dXJuIGl0ZW1FbGVtZW50XG59XG5mdW5jdGlvbiBjcmVhdGVJdGVtQnV0dG9uc0VsZW1lbnQoaXRlbUlEKXtcblxuICAgIGNvbnN0IGl0ZW1CdXR0b25zRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgaXRlbUJ1dHRvbnNFbGVtZW50LmNsYXNzTmFtZSA9ICd0b2RvLWl0ZW0tYnV0dG9ucydcbiAgICAvLyBidXR0b24gZWRpdFxuICAgIGNvbnN0IGVkaXRCdXR0b25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJylcbiAgICBlZGl0QnV0dG9uRWxlbWVudC5pbm5lclRleHQgPSAnZWRpdCdcbiAgICBlZGl0QnV0dG9uRWxlbWVudC5jbGFzc05hbWUgPSAnaXRlbS1lZGl0LWJ1dHRvbidcbiAgICBlZGl0QnV0dG9uRWxlbWVudC5vbmNsaWNrID0gZnVuY3Rpb24oKXtcbiAgICAgICAgLy8gc2V0IG1lbnUgdG8gZWRpdGluZyBzdGF0ZVxuICAgICAgICBlZGl0TW9kZSA9IHRydWVcbiAgICAgICAgZWRpdGVkSUQgPSBpdGVtSURcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1idXR0b24nKS5oaWRkZW4gPSBmYWxzZVxuICAgICAgICBzZXRJbm5lclRleHQoJ2FwcGx5LWJ1dHRvbicsJ0FwcGx5JylcbiAgICAgICAgY29uc3QgdGl0bGUgPSBnZXRJbm5lclRleHQoYHRpdGxlJHtpdGVtSUR9YClcbiAgICAgICAgY29uc3QgY29udGVudCA9IGdldElubmVyVGV4dChgY29udGVudCR7aXRlbUlEfWApXG4gICAgICAgIHNldFZhbHVlKCd0aXRsZS1pbnB1dCcsdGl0bGUpXG4gICAgICAgIHNldFZhbHVlKCdjb250ZW50LWlucHV0Jyxjb250ZW50KVxuICAgIH1cbiAgICAvLyBidXR0b24gZGVsZXRlXG4gICAgY29uc3QgZGVsZXRlQnV0dG9uRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpXG4gICAgZGVsZXRlQnV0dG9uRWxlbWVudC5pbm5lclRleHQgPSAnZGVsZXRlJ1xuICAgIGRlbGV0ZUJ1dHRvbkVsZW1lbnQuY2xhc3NOYW1lID0gJ2l0ZW0tZGVsZXRlLWJ1dHRvbidcbiAgICBkZWxldGVCdXR0b25FbGVtZW50Lm9uY2xpY2sgPSBmdW5jdGlvbigpe1xuICAgICAgICBpZihlZGl0TW9kZSl7XG4gICAgICAgICAgICBhbGVydCgnY2FudCBkZWxldGUgd2hpbGUgaW4gZWRpdCBtb2RlJylcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpdGVtSUQpXG4gICAgICAgIGNvbnN0IGxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGlzdCcpXG4gICAgICAgIC8vIHJlbW92ZSBmcm9tIGRpc3BsYXlcbiAgICAgICAgbGlzdC5yZW1vdmVDaGlsZChpdGVtKVxuICAgICAgICAvLyByZW1vdmUgZnJvbSBpdGVtIHN0b3JhZ2VcbiAgICAgICAgcmVtb3ZlSXRlbUZyb21Mb2NhbHN0b3JhZ2UoaXRlbUlEKVxuICAgIH1cbiAgICAvLyBhcHBlbmQgdGhlIGJ1dHRvbnMgdG8gY29udGFpbmVyXG4gICAgaXRlbUJ1dHRvbnNFbGVtZW50LmFwcGVuZENoaWxkKGVkaXRCdXR0b25FbGVtZW50KVxuICAgIGl0ZW1CdXR0b25zRWxlbWVudC5hcHBlbmRDaGlsZChkZWxldGVCdXR0b25FbGVtZW50KVxuXG4gICAgcmV0dXJuIGl0ZW1CdXR0b25zRWxlbWVudFxufVxuZnVuY3Rpb24gY3JlYXRlSXRlbVRleHRFbGVtZW50KGl0ZW1JRCx0aXRsZSxjb250ZW50KXtcblxuICAgIGNvbnN0IGl0ZW1UZXh0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgaXRlbVRleHRFbGVtZW50LmNsYXNzTmFtZSA9ICd0b2RvLWl0ZW0tdGV4dCdcbiAgICAvLyBpdGVtIHRpdGxlXG4gICAgY29uc3QgdGl0bGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aXRsZUVsZW1lbnQuaW5uZXJUZXh0ID0gdGl0bGVcbiAgICB0aXRsZUVsZW1lbnQuY2xhc3NOYW1lID0gJ3RvZG8taXRlbS10aXRsZSdcbiAgICB0aXRsZUVsZW1lbnQuaWQgPSAndGl0bGUnK2l0ZW1JRFxuICAgIC8vIGl0ZW0gY29udGVudFxuICAgIGNvbnN0IGNvbnRlbnRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICBjb250ZW50RWxlbWVudC5pbm5lclRleHQgPSBjb250ZW50XG4gICAgY29udGVudEVsZW1lbnQuY2xhc3NOYW1lID0gJ3RvZG8taXRlbS1jb250ZW50J1xuICAgIGNvbnRlbnRFbGVtZW50LmlkID0gJ2NvbnRlbnQnK2l0ZW1JRFxuICAgIC8vIGFwcGVuZCB0ZXh0IHRvIHBhcmVudCBjb250YWluZXIgXG4gICAgaXRlbVRleHRFbGVtZW50LmFwcGVuZENoaWxkKHRpdGxlRWxlbWVudClcbiAgICBpdGVtVGV4dEVsZW1lbnQuYXBwZW5kQ2hpbGQoY29udGVudEVsZW1lbnQpXG5cbiAgICByZXR1cm4gaXRlbVRleHRFbGVtZW50XG59XG5cbndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpe1xuICAgIC8vIGF0dGFjaCBmdW5jdGlvbnMgdG8gbWVudSBidXR0b25zXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lbnUnKS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykge1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcGx5LWJ1dHRvbicpLmNsaWNrKClcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aXRsZS1pbnB1dCcpLmZvY3VzKClcbiAgICAgICAgfVxuICAgIH0pXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyLWJ1dHRvbicpLm9uY2xpY2sgPSBjbGVhck1lbnVcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBwbHktYnV0dG9uJykub25jbGljayA9IG1lbnVCdXR0b25DbGlja1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtYnV0dG9uJykub25jbGljayA9IGNhbmNlbEVkaXRcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLWJ1dHRvbicpLm9uY2xpY2sgPSBhZGRCdXR0b25cbiAgICAvLyBpbml0IHRvZG8gbGlzdCBpbiBzdG9yYWdlXG4gICAgaWYobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ1RPRE8tTGlzdCcpPT1udWxsKXtcbiAgICAgICAgY29uc3QgdG9kb01hcCA9IEpTT04uc3RyaW5naWZ5KHt9KVxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnVE9ETy1MaXN0Jyx0b2RvTWFwKVxuICAgIH1cbiAgICAvLyBsb2FkIGFuZCBkaXNwbGF5IHRvZG8gaXRlbXMgZnJvbSBsb2NhbCBzdG9yYWdlXG4gICAgY29uc3QgdG9kb0xpc3RTdHJpbmcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnVE9ETy1MaXN0JylcbiAgICBjb25zdCB0b2RvTWFwID0gSlNPTi5wYXJzZSh0b2RvTGlzdFN0cmluZylcbiAgICBjb25zdCBsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpc3QnKVxuICAgIGZvciAoY29uc3Qga2V5IGluIHRvZG9NYXApIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IHRvZG9NYXBba2V5XVxuICAgICAgICBjb25zdCB0aXRsZSA9IGl0ZW1bJ3RpdGxlJ11cbiAgICAgICAgY29uc3QgY29udGVudCA9IGl0ZW1bJ2NvbnRlbnQnXVxuICAgICAgICBjb25zdCBpdGVtRWxlbWVudCA9IGNyZWF0ZVRvZG9JdGVtRWxlbWVudChrZXksdGl0bGUsY29udGVudClcbiAgICAgICAgbGlzdC5hcHBlbmRDaGlsZChpdGVtRWxlbWVudClcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiZWRpdGVkSUQiLCJlZGl0TW9kZSIsImdldE5ld0lEIiwiRGF0ZSIsImdldFRpbWUiLCJ0b1N0cmluZyIsImFkZEl0ZW0iLCJ0aXRsZSIsImdldFZhbHVlIiwiYWxlcnQiLCJjb250ZW50IiwibGlzdCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpZCIsInNldEl0ZW1Ub0xvY2Fsc3RvcmFnZSIsIml0ZW1FbGVtZW50IiwiY3JlYXRlVG9kb0l0ZW1FbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJjbGVhck1lbnUiLCJzZXRJbm5lclRleHQiLCJpdGVtIiwidG9kb0xpc3RTdHJpbmciLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwidG9kb01hcCIsIkpTT04iLCJwYXJzZSIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJyZW1vdmVJdGVtRnJvbUxvY2Fsc3RvcmFnZSIsInNlbmRJdGVtVG9FZGl0IiwiaXRlbUlEIiwiZ2V0SW5uZXJUZXh0Iiwic2V0VmFsdWUiLCJoaWRkZW4iLCJkZWxldGVJdGVtIiwicmVtb3ZlQ2hpbGQiLCJyZW1vdmVJdGVtIiwiY2FuY2VsRWRpdCIsIm1lbnVCdXR0b25DbGljayIsImFkZEJ1dHRvbiIsImZvY3VzIiwidmFsdWUiLCJpbm5lclRleHQiLCJ0ZXh0IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsIml0ZW1DaGVja2JveEVsZW1lbnQiLCJ0eXBlIiwiaXRlbVRleHRFbGVtZW50IiwiY3JlYXRlSXRlbVRleHRFbGVtZW50IiwiaXRlbUJ1dHRvbnNFbGVtZW50IiwiY3JlYXRlSXRlbUJ1dHRvbnNFbGVtZW50IiwiZWRpdEJ1dHRvbkVsZW1lbnQiLCJvbmNsaWNrIiwiZGVsZXRlQnV0dG9uRWxlbWVudCIsInRpdGxlRWxlbWVudCIsImNvbnRlbnRFbGVtZW50Iiwid2luZG93Iiwib25sb2FkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50Iiwia2V5Q29kZSIsImNsaWNrIiwia2V5Il0sInNvdXJjZVJvb3QiOiIifQ==